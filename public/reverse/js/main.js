// Generated by CoffeeScript 1.3.1
(function() {
  "use strict";

  var Message;

  if (navigator.language === "ja") {
    Message = {
      openWithChrome: "Chrome で開いてね!!",
      dragAndDropToPlay: "音楽ファイルをドラッグ & ドロップすると再生します.",
      play: "再生を開始します.",
      cannotPlay: "再生できないファイルです."
    };
  } else {
    Message = {
      openWithChrome: "Please open with Chrome",
      dragAndDropToPlay: "Drag & drop an audio file to play",
      play: "Play",
      cannotPlay: "Cannot play"
    };
  }

  jQuery(function() {
    var $body, ctx, synth;
    synth = T("buffer").set({
      loop: true,
      reversed: true
    }).play();
    ctx = null;
    $body = $(document.body);
    $body.on("dragover", function(e) {
      e.preventDefault();
      return e.stopPropagation();
    });
    $body.on("drop", function(e) {
      var reader;
      e.preventDefault();
      e.stopPropagation();
      if (ctx === null) {
        return;
      }
      reader = new FileReader();
      reader.onload = function(e) {
        var buffer;
        try {
          buffer = ctx.createBuffer(e.target.result, true).getChannelData(0);
          synth.buffer = buffer;
          $("#text").text(Message.play);
          return setTimeout(function() {
            return $("#text").text(Message.dragAndDropToPlay);
          }, 5000);
        } catch (e) {
          return $("#text").text(Message.cannotPlay);
        }
      };
      return reader.readAsArrayBuffer(e.originalEvent.dataTransfer.files[0]);
    });
    if (timbre.env === "webkit") {
      ctx = new webkitAudioContext();
      return $("#text").text(Message.dragAndDropToPlay);
    } else {
      return $("#text").text(Message.openWithChrome);
    }
  });

}).call(this);
